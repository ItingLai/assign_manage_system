import{d as D,r as b,o as j,a as u,c as x,e as _,b as t,g as a,m as i,t as B,B as y,A as w,u as s,E as g,j as z,p as R,q as W,k as A,f as $,w as G,i as J,h as N,n as K,x as Q,y as X,v as Y,C as Z,s as ee,z as te,l as ae,D as le,G as oe}from"./index-2d2b0b3d.js";/* empty css                        *//* empty css               */import{o as S,c as F}from"./loading-bf393b7e.js";/* empty css                  *//* empty css                   *//* empty css                *//* empty css                 *//* empty css                       */import"./el-form-item-4ed993c7.js";import{F as ne,i as se}from"./index-710185f6.js";import{i as re}from"./index-b4cf4bd5.js";/* empty css                       */const ie={style:{display:"flex","justify-content":"space-between","align-items":"center"}},de=_("h1",null,"請假紀錄",-1),ue={style:{margin:"1rem 0 0 2rem"}},pe={class:"userInfo"},_e=_("span",{class:"title"},"請假原因: ",-1),ce={key:0,class:"userInfo"},fe=_("span",{class:"title"},"未通過理由: ",-1),me=D({__name:"leaveHistory",setup(C){const c=b([]),p=()=>{S(),fetch("api/getLeaveHistory",{headers:{"Content-Type":"application/json"}}).then(r=>r.json()).then(r=>{r.code===200?c.value=r.data:g.error("取得資料失敗")}).catch(()=>{g.error("取得資料失敗")}).finally(()=>{F()})};return j(()=>{p()}),(r,h)=>{const v=z,e=R,d=W,k=A;return u(),x("div",null,[_("div",ie,[de,t(v,{type:"primary",onClick:h[0]||(h[0]=o=>p())},{default:a(()=>[i("重新獲取資料")]),_:1})]),t(k,{data:s(c),stripe:"",style:{width:"100%"},border:!0},{default:a(()=>[t(e,{type:"expand"},{default:a(o=>[_("div",ue,[_("p",pe,[_e,i(" "+B(o.row.reason),1)]),o.row.status===0?(u(),x("p",ce,[fe,i(" "+B(o.row.not_agree_reason),1)])):y("",!0)])]),_:1}),t(e,{prop:"date",label:"申請日期"}),t(e,{prop:"name",label:"姓名"}),t(e,{prop:"type",label:"假別"},{default:a(o=>[o.row.type==="sick"?(u(),w(d,{key:0,class:"ml-2",effect:"dark"},{default:a(()=>[i("病假")]),_:1})):y("",!0),o.row.type==="personal"?(u(),w(d,{key:1,class:"ml-2",type:"warning",effect:"dark"},{default:a(()=>[i("事假")]),_:1})):y("",!0),o.row.type==="official"?(u(),w(d,{key:2,class:"ml-2",type:"info",effect:"dark"},{default:a(()=>[i("公假")]),_:1})):y("",!0),o.row.type==="annual"?(u(),w(d,{key:3,class:"ml-2",type:"success",effect:"dark"},{default:a(()=>[i("特休")]),_:1})):y("",!0)]),_:1}),t(e,{prop:"start",label:"起始日期"}),t(e,{prop:"end",label:"結束日期"}),t(e,{prop:"status",label:"審核狀態",width:"100",fixed:"right"},{default:a(o=>[o.row.status===null?(u(),w(d,{key:0,type:"warning",effect:"dark"},{default:a(()=>[i("審核中")]),_:1})):y("",!0),o.row.status===1?(u(),w(d,{key:1,type:"success",effect:"dark"},{default:a(()=>[i("已准許")]),_:1})):y("",!0),o.row.status===0?(u(),w(d,{key:2,type:"danger",effect:"dark"},{default:a(()=>[i("未通過")]),_:1})):y("",!0)]),_:1})]),_:1},8,["data"])])}}});const ve=_("div",null,[_("ul",null,[_("li",null,"點擊要請假日期即可申請請假")])],-1),ye={class:"dialog-footer"},ge=D({__name:"leave",setup(C){const c=b(null),p=b(!1),r=b(null),h=b(!0),v=b("90%"),e=$({leave_type:"",leave_date:"",leave_reason:""}),d=f=>{let l=f.date;h.value=!0,e.leave_date=[l,l],p.value=!0},k=(f,l)=>{let n=new Date;n.setHours(0,0,0,0);let V;return l=="official"?V=new Date(n.setDate(n.getDate()+3)):V=new Date(n.setDate(n.getDate()+14)),new Date(f)>=V},o=()=>{let f=e.leave_type=="sick"?"病假":e.leave_type=="personal"?"事假":e.leave_type=="official"?"公假":"特休";r.value.getApi().addEvent({title:f,start:e.leave_date[0],end:e.leave_date[1],allDay:!0}),p.value=!1},H=f=>{f&&f.validate(l=>{if(l)K.confirm("確定要送出請假申請嗎?","提示",{confirmButtonText:"確定",cancelButtonText:"取消",type:"warning"}).then(()=>{if(e.leave_type==="official"&&k(e.leave_date[0],"official")==!1){g.error("公假需提前三天申請!");return}if(e.leave_type==="annual"&&k(e.leave_date[0],"annual")==!1){g.error("特休需提前兩周申請!");return}S("資料傳輸中..."),fetch("api/applyLeave",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({leaveType:e.leave_type,leaveDate:e.leave_date,leaveReason:e.leave_reason})}).then(n=>n.json()).then(n=>{n.code===200?(g.success("申請成功"),o(),T()):g.error("申請失敗")}).catch(()=>{g.error("申請失敗")}).finally(()=>{F()})}).catch(()=>{});else return g.error("資料不完整!"),!1})},T=()=>{e.leave_type="",e.leave_date="",e.leave_reason=""},I=$({leave_type:[{required:!0,message:"請選擇假別",trigger:"change"}],leave_date:[{required:!0,message:"請選擇請假日期",trigger:"change"}],leave_reason:[{required:!0,message:"請填寫請假原因",trigger:"change"}]}),U={plugins:[se,re],selectable:!0,initialView:"dayGridMonth",dateClick:d,locale:"zh-tw",buttonText:{today:"當月"},events:[]};return j(()=>{v.value=window.innerWidth<768?"90%":"50%",window.addEventListener("resize",()=>{v.value=window.innerWidth<768?"90%":"50%"})}),G(J,()=>{setTimeout(()=>{r.value.getApi().updateSize()},500)}),(f,l)=>{const n=Q,V=X,E=Y,q=Z,M=ee,O=te,L=z,P=ae;return u(),x("div",null,[ve,t(s(ne),{ref_key:"fullCalendar",ref:r,options:U},null,512),t(P,{modelValue:s(p),"onUpdate:modelValue":l[5]||(l[5]=m=>N(p)?p.value=m:null),title:"請假申請",width:s(v)},{footer:a(()=>[_("span",ye,[t(L,{onClick:l[3]||(l[3]=m=>(p.value=!1,T()))},{default:a(()=>[i("取消")]),_:1}),t(L,{type:"primary",onClick:l[4]||(l[4]=m=>H(s(c)))},{default:a(()=>[i(" 新增請假 ")]),_:1})])]),default:a(()=>[t(O,{model:s(e),ref_key:"formRef",ref:c,rules:s(I)},{default:a(()=>[t(E,{label:"假別",prop:"leave_type"},{default:a(()=>[t(V,{modelValue:s(e).leave_type,"onUpdate:modelValue":l[0]||(l[0]=m=>s(e).leave_type=m),placeholder:"請選擇假別"},{default:a(()=>[t(n,{label:"病假",value:"sick"}),t(n,{label:"事假",value:"personal"}),t(n,{label:"公假",value:"official"}),t(n,{label:"特休",value:"annual"})]),_:1},8,["modelValue"])]),_:1}),t(E,{label:"請假日期",prop:"leave_date"},{default:a(()=>[t(q,{modelValue:s(e).leave_date,"onUpdate:modelValue":l[1]||(l[1]=m=>s(e).leave_date=m),type:"daterange","range-separator":"到","start-placeholder":"起始日期","end-placeholder":"結束日期"},null,8,["modelValue"])]),_:1}),t(E,{label:"請假原因",prop:"leave_reason"},{default:a(()=>[t(M,{modelValue:s(e).leave_reason,"onUpdate:modelValue":l[2]||(l[2]=m=>s(e).leave_reason=m),type:"textarea"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","width"])])}}}),je=D({__name:"applyLeave",setup(C){const c=b("apply");return(p,r)=>{const h=ge,v=oe,e=me,d=le;return u(),x("div",null,[t(d,{modelValue:s(c),"onUpdate:modelValue":r[0]||(r[0]=k=>N(c)?c.value=k:null)},{default:a(()=>[t(v,{label:"請假申請",name:"apply",lazy:""},{default:a(()=>[t(h)]),_:1}),t(v,{label:"申請紀錄",name:"history",lazy:""},{default:a(()=>[t(e)]),_:1})]),_:1},8,["modelValue"])])}}});export{je as default};
